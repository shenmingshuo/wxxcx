# 2048 æ¸¸æˆé›†æˆæ–‡æ¡£

## æ¦‚è¿°

æˆåŠŸå°†ç»å…¸çš„ 2048 æ¸¸æˆé›†æˆåˆ°å¾®ä¿¡å°æ¸¸æˆåˆé›†ä¸­ã€‚è¿™ä¸ªæ¸¸æˆåŸºäº GitHub é¡¹ç›® [mate-academy/js_2048_game](https://github.com/mate-academy/js_2048_game)ï¼Œå¹¶å®Œå…¨é€‚é…äº†æˆ‘ä»¬çš„æ¸¸æˆæ¡†æ¶ã€‚

## æ¸¸æˆç‰¹æ€§

### âœ… æ ¸å¿ƒåŠŸèƒ½
- **ç»å…¸ 2048 ç©æ³•**ï¼šæ»‘åŠ¨åˆå¹¶ç›¸åŒæ•°å­—ï¼ŒæŒ‘æˆ˜è¾¾åˆ° 2048ï¼
- **è§¦æ‘¸æ§åˆ¶**ï¼šæ”¯æŒä¸Šä¸‹å·¦å³å››ä¸ªæ–¹å‘çš„æ»‘åŠ¨æ“ä½œ
- **å¾—åˆ†ç³»ç»Ÿ**ï¼šå®æ—¶æ˜¾ç¤ºå½“å‰å¾—åˆ†
- **æ™ºèƒ½ç”Ÿæˆ**ï¼š90% æ¦‚ç‡ç”Ÿæˆ 2ï¼Œ10% æ¦‚ç‡ç”Ÿæˆ 4
- **æ¸¸æˆçŠ¶æ€æ£€æµ‹**ï¼š
  - è¾¾åˆ° 2048 è‡ªåŠ¨æç¤ºè·èƒœ
  - æ— æ³•ç§»åŠ¨æ—¶æç¤ºæ¸¸æˆç»“æŸ

### ğŸ¨ UI/UX è®¾è®¡
- **ç²¾ç¾é…è‰²**ï¼š
  - ä¸åŒæ•°å­—ä½¿ç”¨ä¸åŒèƒŒæ™¯è‰²å’Œæ–‡å­—è‰²
  - ä»æµ…è‰²ï¼ˆ2ï¼‰åˆ°æ·±è‰²ï¼ˆ2048ï¼‰çš„æ¸å˜é…è‰²
  - ç¬¦åˆå¾®ä¿¡å°æ¸¸æˆé£æ ¼çš„ç•Œé¢è®¾è®¡
- **é¡¶éƒ¨æ **ï¼š
  - å·¦ä¾§ï¼šè¿”å›æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤å¼¹çª—ï¼‰
  - ä¸­é—´ï¼šå½“å‰å¾—åˆ†æ˜¾ç¤º
  - å³ä¾§ï¼šé‡å¯æŒ‰é’®ï¼ˆå¸¦ç¡®è®¤å¼¹çª—ï¼‰
- **æ¸¸æˆåŒºåŸŸ**ï¼š
  - 4x4 ç½‘æ ¼å¸ƒå±€
  - åœ†è§’å¡ç‰‡è®¾è®¡
  - å“åº”å¼å°ºå¯¸é€‚é…
- **åº•éƒ¨æç¤º**ï¼šæ»‘åŠ¨æ“ä½œå¼•å¯¼

### ğŸ¯ é€‚é…ç»†èŠ‚
- **é¿å¼€åˆ˜æµ·/çµåŠ¨å²›**ï¼šé¡¶éƒ¨æ ä½ç½®ä¸‹ç§»è‡³å®‰å…¨åŒºåŸŸ
- **ç¡®è®¤å¯¹è¯æ¡†**ï¼šè¿”å›å’Œé‡å¯éƒ½éœ€è¦ç”¨æˆ·ç¡®è®¤ï¼Œé˜²æ­¢è¯¯æ“ä½œ
- **è§¦æ‘¸ä¼˜åŒ–**ï¼š
  - æœ€å°æ»‘åŠ¨è·ç¦»é˜ˆå€¼ï¼ˆ50pxï¼‰
  - åŒºåˆ†æ¨ªå‘/çºµå‘æ»‘åŠ¨
  - æ”¯æŒæŒ‰é’®ç‚¹å‡»æ£€æµ‹

## æ–‡ä»¶ç»“æ„

```
/Users/shuo/Downloads/Dev/wxapp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ games/
â”‚   â”‚   â””â”€â”€ Game2048.ts          # 2048 æ¸¸æˆä¸»é€»è¾‘ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ scenes/
â”‚   â”‚   â””â”€â”€ MenuScene.ts         # ä¸»èœå•ï¼ˆå·²æ›´æ–°ï¼Œæ·»åŠ æ¸¸æˆå…¥å£ï¼‰
â”‚   â””â”€â”€ game.ts                  # ä¸»å…¥å£ï¼ˆå·²æ›´æ–°ï¼Œæ³¨å†Œæ¸¸æˆï¼‰
â””â”€â”€ js/
    â””â”€â”€ games/
        â””â”€â”€ Game2048.js          # ç¼–è¯‘åçš„æ–‡ä»¶
```

## æ ¸å¿ƒä»£ç è§£æ

### 1. æ¸¸æˆçŠ¶æ€ç®¡ç†

```typescript
private board: number[][];              // 4x4 æ¸¸æˆæ£‹ç›˜
private score: number = 0;              // å½“å‰å¾—åˆ†
private status: 'idle' | 'playing' | 'win' | 'lose' = 'idle';  // æ¸¸æˆçŠ¶æ€
```

### 2. æ»‘åŠ¨æ§åˆ¶

```typescript
private handleSwipe(): void {
  const deltaX = this.touchEndX - this.touchStartX;
  const deltaY = this.touchEndY - this.touchStartY;
  
  // åˆ¤æ–­æ¨ªå‘è¿˜æ˜¯çºµå‘æ»‘åŠ¨
  if (Math.abs(deltaX) > Math.abs(deltaY)) {
    deltaX > 0 ? this.moveRight() : this.moveLeft();
  } else {
    deltaY > 0 ? this.moveDown() : this.moveUp();
  }
}
```

### 3. æ•°å­—åˆå¹¶é€»è¾‘

```typescript
private mergeLine(line: number[]): number[] {
  // 1. ç§»é™¤ 0
  const filtered = line.filter((val) => val !== 0);
  const merged: number[] = [];
  let i = 0;

  // 2. åˆå¹¶ç›¸åŒæ•°å­—
  while (i < filtered.length) {
    if (i < filtered.length - 1 && filtered[i] === filtered[i + 1]) {
      const mergedValue = filtered[i] * 2;
      merged.push(mergedValue);
      this.score += mergedValue;  // å¢åŠ å¾—åˆ†
      i += 2;
    } else {
      merged.push(filtered[i]);
      i++;
    }
  }

  // 3. å¡«å…… 0 åˆ°é•¿åº¦ 4
  while (merged.length < 4) {
    merged.push(0);
  }

  return merged;
}
```

### 4. æ¸¸æˆç»“æŸåˆ¤æ–­

```typescript
private canMove(): boolean {
  // æ£€æŸ¥æ˜¯å¦æœ‰ç©ºæ ¼
  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 4; col++) {
      if (this.board[row][col] === 0) return true;
    }
  }

  // æ£€æŸ¥æ˜¯å¦æœ‰ç›¸é‚»çš„ç›¸åŒæ•°å­—
  for (let row = 0; row < 4; row++) {
    for (let col = 0; col < 4; col++) {
      const current = this.board[row][col];
      if (col < 3 && this.board[row][col + 1] === current) return true;
      if (row < 3 && this.board[row + 1][col] === current) return true;
    }
  }

  return false;
}
```

## ä½¿ç”¨æ–¹æ³•

### åœ¨ä¸»èœå•å¯åŠ¨æ¸¸æˆ
1. æ‰“å¼€å¾®ä¿¡å°æ¸¸æˆ
2. åœ¨ä¸»èœå•ä¸­æ‰¾åˆ° "2048 ğŸ²" å¡ç‰‡
3. ç‚¹å‡»"å¼€å§‹"æŒ‰é’®è¿›å…¥æ¸¸æˆ

### æ¸¸æˆæ“ä½œ
- **æ»‘åŠ¨å±å¹•**ï¼šä¸Šä¸‹å·¦å³æ»‘åŠ¨æ¥ç§»åŠ¨æ•°å­—
- **è¿”å›æŒ‰é’®**ï¼šç‚¹å‡»å·¦ä¸Šè§’è¿”å›ä¸»èœå•ï¼ˆéœ€ç¡®è®¤ï¼‰
- **é‡å¯æŒ‰é’®**ï¼šç‚¹å‡»å³ä¸Šè§’é‡æ–°å¼€å§‹æ¸¸æˆï¼ˆéœ€ç¡®è®¤ï¼‰

### æ¸¸æˆç›®æ ‡
- é€šè¿‡æ»‘åŠ¨åˆå¹¶ç›¸åŒçš„æ•°å­—
- æœ€ç»ˆè¾¾åˆ° 2048 å³ä¸ºè·èƒœ
- è·èƒœåå¯ä»¥é€‰æ‹©ç»§ç»­æ¸¸æˆæˆ–é‡æ–°å¼€å§‹

## é›†æˆè¦ç‚¹

### 1. å®ç° Scene æ¥å£
```typescript
export class Game2048 implements Scene {
  name = 'game2048';
  
  init(): void { /* åˆå§‹åŒ– */ }
  enter(): void { /* è¿›å…¥åœºæ™¯ */ }
  exit(): void { /* é€€å‡ºåœºæ™¯ */ }
  update(deltaTime: number): void { /* æ›´æ–°é€»è¾‘ */ }
  render(ctx: CanvasRenderingContext2D): void { /* æ¸²æŸ“ */ }
}
```

### 2. æ³¨å†Œåˆ°ç³»ç»Ÿ
```typescript
// src/game.ts
import { Game2048 } from './games/Game2048';

const game2048 = new Game2048();
game2048.setSceneManager(this.sceneManager);
game2048.setGameBridge(this.gameBridge);
this.sceneManager.register(game2048);
```

### 3. æ·»åŠ åˆ°ä¸»èœå•
```typescript
// src/scenes/MenuScene.ts
{
  id: 'game2048',
  name: '2048',
  description: 'æ»‘åŠ¨åˆå¹¶æ•°å­—ï¼ŒæŒ‘æˆ˜2048ï¼',
  icon: 'ğŸ²',
  supportMultiplayer: false,
  minPlayers: 1,
  maxPlayers: 1,
  duration: 300
}
```

## å…³é”®æŠ€æœ¯

### Canvas ç»˜åˆ¶
- ä½¿ç”¨ `roundRect` æ–¹æ³•ç»˜åˆ¶åœ†è§’çŸ©å½¢
- æ ¹æ®æ•°å­—å¤§å°åŠ¨æ€è°ƒæ•´å­—ä½“å°ºå¯¸
- ä¸åŒæ•°å€¼ä½¿ç”¨ä¸åŒçš„é…è‰²æ–¹æ¡ˆ

### è§¦æ‘¸äº‹ä»¶
- `wx.onTouchStart`ï¼šè®°å½•è§¦æ‘¸èµ·ç‚¹
- `wx.onTouchEnd`ï¼šè®°å½•è§¦æ‘¸ç»ˆç‚¹å¹¶è®¡ç®—æ»‘åŠ¨æ–¹å‘
- æœ€å°æ»‘åŠ¨è·ç¦»é˜ˆå€¼é˜²æ­¢è¯¯è§¦

### æ€§èƒ½ä¼˜åŒ–
- ä½¿ç”¨ `JSON.stringify` å¿«é€Ÿæ¯”è¾ƒæ•°ç»„çŠ¶æ€
- é¿å…ä¸å¿…è¦çš„é‡ç»˜
- å±€éƒ¨æ›´æ–°è€Œéå…¨å±€åˆ·æ–°

## å¯æ‰©å±•åŠŸèƒ½

### æœªæ¥å¯ä»¥æ·»åŠ ï¼š
1. **åŠ¨ç”»æ•ˆæœ**ï¼š
   - æ•°å­—ç§»åŠ¨åŠ¨ç”»
   - åˆå¹¶æ—¶çš„ç¼©æ”¾åŠ¨ç”»
   - æ–°æ•°å­—å‡ºç°çš„æ·¡å…¥åŠ¨ç”»

2. **éš¾åº¦æ¨¡å¼**ï¼š
   - ç®€å•æ¨¡å¼ï¼š3x3 ç½‘æ ¼
   - å›°éš¾æ¨¡å¼ï¼š5x5 ç½‘æ ¼
   - æŒ‘æˆ˜æ¨¡å¼ï¼šè¾¾åˆ° 4096

3. **æ’è¡Œæ¦œ**ï¼š
   - é›†æˆå¼€æ”¾æ•°æ®åŸŸ
   - æ˜¾ç¤ºå¥½å‹æœ€é«˜åˆ†
   - å…¨çƒæ’è¡Œæ¦œ

4. **éŸ³æ•ˆ**ï¼š
   - æ»‘åŠ¨éŸ³æ•ˆ
   - åˆå¹¶éŸ³æ•ˆ
   - èƒŒæ™¯éŸ³ä¹

5. **é“å…·ç³»ç»Ÿ**ï¼š
   - æ’¤é”€ä¸€æ­¥
   - ç§»é™¤ä¸€ä¸ªæ•°å­—
   - æ”¹å˜ä¸€ä¸ªæ•°å­—

## å‚è€ƒèµ„æº

- **åŸå§‹é¡¹ç›®**ï¼šhttps://github.com/mate-academy/js_2048_game
- **æ¸¸æˆè§„åˆ™**ï¼šhttps://play2048.co/
- **å¾®ä¿¡å°æ¸¸æˆæ–‡æ¡£**ï¼šhttps://developers.weixin.qq.com/minigame/dev/

## æ€»ç»“

è¿™æ¬¡é›†æˆå±•ç¤ºäº†å¦‚ä½•å°† GitHub ä¸Šçš„ç»å…¸æ¸¸æˆä»£ç é€‚é…åˆ°æˆ‘ä»¬çš„å¾®ä¿¡å°æ¸¸æˆæ¡†æ¶ä¸­ã€‚å…³é”®æ­¥éª¤åŒ…æ‹¬ï¼š

1. âœ… ç†è§£åŸå§‹ä»£ç çš„æ ¸å¿ƒé€»è¾‘
2. âœ… å®ç°æ¡†æ¶æ‰€éœ€çš„ `Scene` æ¥å£
3. âœ… é€‚é…å¾®ä¿¡å°æ¸¸æˆçš„è§¦æ‘¸äº‹ä»¶
4. âœ… ä¼˜åŒ– UI ä»¥ç¬¦åˆå¾®ä¿¡å°æ¸¸æˆé£æ ¼
5. âœ… æ³¨å†Œåˆ°ä¸»ç³»ç»Ÿå¹¶æ·»åŠ èœå•å…¥å£

è¿™ä¸ªæµç¨‹å¯ä»¥ä½œä¸ºé›†æˆå…¶ä»–æ¸¸æˆçš„å‚è€ƒæ¨¡æ¿ï¼ğŸ‰

